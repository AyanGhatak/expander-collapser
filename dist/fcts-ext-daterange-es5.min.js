!function(t){function e(o){if(a[o])return a[o].exports;var n=a[o]={exports:{},id:o,loaded:!1};return t[o].call(n.exports,n,n.exports,e),n.loaded=!0,n.exports}var a={};return e.m=t,e.c=a,e.p="",e(0)}([function(t,e,a){(function(t){"use strict";var e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o=a(2);window.dr=new o,function(a,o){"object"===e(t)&&t.exports?t.exports=a.document?o(a):function(t){if(!t.document)throw new Error("Window with document not present");return o(t,!0)}:a.DateRangeChooser=o(a,!0)}("undefined"!=typeof window?window:void 0,function(t,e){var a=t.FusionCharts;a.register("extension",["private","DateRangeChooser",function(){a.registerComponent("extensions","DateRangeChooser",o)}])})}).call(e,a(1)(t))},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children=[],t.webpackPolyfill=1),t}},function(t,e){"use strict";function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var o=function(){function t(t,e){for(var a=0;a<e.length;a++){var o=e[a];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,a,o){return a&&t(e.prototype,a),o&&t(e,o),e}}(),n=function(){function t(){a(this,t),this.startDt=0,this.endDt=0,this.startDataset=0,this.endDataset=0,"function"==typeof Fusioncharts&&(this.toolbox=FusionCharts.getComponent("api","toolbox"),this.HorizontalToolbar=this.toolbox.HorizontalToolbar,this.ComponentGroup=this.toolbox.ComponentGroup,this.SymbolStore=this.toolbox.SymbolStore),this.startText={attr:function(){}},this.endText={attr:function(){}}}return o(t,[{key:"swapDates",value:function(){var t=this.dateRange.startDate;this.dateRange.startDate=this.dateRange.endDate,this.dateRange.endDate=t}},{key:"syncRange",value:function(){}},{key:"getFormattedDate",value:function(t){return this.chart.getFormattedDate(t)}},{key:"getTimestamp",value:function(t){return this.chart.getTimestamp(t)}},{key:"setConfig",value:function(t){}},{key:"getConfig",value:function(){return{calendarVisible:"false"}}},{key:"init",value:function(t){var e=this;return t(["xAxis","yAxis","graphics","chart","dataset","PlotManager","canvasConfig","MarkerManager","reactiveModel","globalReactiveModel","spaceManagerInstance","smartLabel","chartInstance",function(t,a,o,n,i,r,s,l,h,c,u,d){e.xAxis=t,e.yAxis=a,e.graphics=o,e.chart=n,e.dataset=i,e.plotManager=r,e.markerManager=l,e.canvasConfig=s,e.reactiveModel=h,e.globalReactiveModel=c,e.spaceManagerInstance=u,e.smartLabel=d}]),this.spaceManagerInstance=e.spaceManagerInstance,this.globalReactiveModel=e.globalReactiveModel,this.startDt=e.globalReactiveModel.model["x-axis-visible-range-start"],this.endDt=e.globalReactiveModel.model["x-axis-visible-range-end"],this.startDataset=e.globalReactiveModel.model["x-axis-absolute-range-start"],this.endDataset=e.globalReactiveModel.model["x-axis-absolute-range-end"],this.toolbars=[],this.measurement={},this.toolbars.push(this.createToolbar()),this}},{key:"createToolbar",value:function(){var t,e,a,o,n,i,r=this;return r.fromDate={},r.toDate={},n=new Date(this.startDt).toLocaleDateString(),i=new Date(this.endDt).toLocaleDateString(),t=new this.HorizontalToolbar({paper:this.graphics.paper,chart:this.chart,smartLabel:this.smartLabel,chartContainer:this.graphics.container}),t.setConfig({fill:"#fff",borderThickness:0}),o=new this.toolbox.ComponentGroup({paper:this.graphics.paper,chart:this.chart,smartLabel:this.smartLabel,chartContainer:this.graphics.container}),o.setConfig({fill:"#fff",borderThickness:0}),e=new this.toolbox.Label("From:",{smartLabel:this.smartLabel,paper:this.graphics.paper},{text:{style:{"font-size":"15",fontFamily:"MyriadPro"}}}),r.fromDate=new this.toolbox.InputTextBoxSymbol({width:120,height:25},{paper:this.graphics.paper,chart:this.chart,smartLabel:this.smartLabel,chartContainer:this.graphics.container},{strokeWidth:1,stroke:"rgba(102,102,102,0.5)",symbolStrokeWidth:0,btnTextStyle:{fontSize:14},label:n}),a=new this.toolbox.Label("To:",{smartLabel:this.smartLabel,paper:this.graphics.paper},{text:{style:{"font-size":"15",fontFamily:"MyriadPro"}}}),r.toDate=new this.toolbox.InputTextBoxSymbol({width:120,height:25},{paper:this.graphics.paper,chart:this.chart,smartLabel:this.smartLabel,chartContainer:this.graphics.container},{strokeWidth:1,stroke:"rgba(102,102,102,0.5)",symbolStrokeWidth:0,btnTextStyle:{fontSize:14},label:i}),r.fromDate.attachEventHandlers({click:{fn:r.fromDate.edit},textOnBlur:function(){r.fromDate.blur(),r.startDate=r.fromDate.getText(),console.log(r.fromDate.getText())}}),r.toDate.attachEventHandlers({click:{fn:r.toDate.edit},textOnBlur:function(){r.toDate.blur(),console.log(r.toDate.getText()),r.endDate=r.toDate.getText()}}),this.SymbolStore.register("textBoxIcon",function(t,e,a,o,n,i,r){var s=t-o/2+i/2,l=t+o/2-i/2,h=e-n/2+r/2,c=e+n/2-r/2;return["M",s,h,"L",l,h,"L",l,c,"L",s,c,"Z"]}),o.addSymbol(e),o.addSymbol(r.fromDate),o.addSymbol(a),o.addSymbol(r.toDate),t.addComponent(o),t}},{key:"getLogicalSpace",value:function(t,e){t/=2;var a,o,n,i=0,r=0;for(o=0,n=this.toolbars.length;o<n;o++)a=this.toolbars[o].getLogicalSpace(),i=Math.max(a.width,i),r+=a.height,this.toolbars[o].width=a.width,this.toolbars[o].height=a.height;return r+=this.padding,{width:i>t?0:i,height:r>e?0:r}}},{key:"placeInCanvas",value:function(){var t=this;t.padding=5,t.spaceManagerInstance.add([{name:function(){return"ToolBoxExt"},ref:function(t){return t[0]},self:function(){return t},priority:function(){return 2},layout:function(t){return t.inline},orientation:[{type:function(t){return t.horizontal},position:[{type:function(t){return t.top},alignment:[{type:function(t){return t.left},dimensions:[function(){var e=this.getParentComponentGroup();return t.getLogicalSpace(e.getWidth(),e.getHeight())}]}]}]}]}])}},{key:"setDrawingConfiguration",value:function(t,e,a,o,n){var i=this.measurement;return i.x=t,i.y=e,i.width=a,i.height=o,this.parentGroup=n,this}},{key:"draw",value:function(t,e,a,o,n){var i,r,s,l=this.measurement,h=this.toolbars,c=this.globalReactiveModel,u=this;if(console.log(c),t=void 0===t?l.x:t,e=void 0===e?l.y:e,a=void 0===a?l.width:a,o=void 0===o?l.height:o,n=void 0===n?this.parentGroup:n,a&&o)for(r=0,i=h.length;r<i;r++)s=h[r],s.draw(t,e);c.onPropsChange(["x-axis-visible-range-start","x-axis-visible-range-end"],function(t,e){u.fromDate.blur(new Date(t[1]).toLocaleDateString()),u.toDate.blur(new Date(e[1]).toLocaleDateString())})}},{key:"startDate",get:function(){return this.startDt},set:function(t){var e=+new Date(t);e<=this.endDt&&(this.startDt=e,this.globalReactiveModel.model["x-axis-visible-range-start"]=this.startDt)}},{key:"endDate",get:function(){return this.endDt},set:function(t){var e=+new Date(t);e>=this.startDt&&(this.endDt=e,this.globalReactiveModel.model["x-axis-visible-range-end"]=this.endDt)}}]),t}();"undefined"!=typeof t&&"undefined"!=typeof t.exports?t.exports=n:window.StandardPeriod=n}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vZmN0cy1leHQtZGF0ZXJhbmdlLWVzNS5taW4uanMiLCJ3ZWJwYWNrOi8vL3dlYnBhY2svYm9vdHN0cmFwIGI0NmY0ZWQxNzVmMjIyMmZmYzE5Iiwid2VicGFjazovLy8uL3NyYy9pbmRleC5qcyIsIndlYnBhY2s6Ly8vKHdlYnBhY2spL2J1aWxkaW4vbW9kdWxlLmpzIiwid2VicGFjazovLy8uL3NyYy9mY3RzLWV4dC1kYXRlcmFuZ2UuanMiXSwibmFtZXMiOlsibW9kdWxlcyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImluc3RhbGxlZE1vZHVsZXMiLCJleHBvcnRzIiwibW9kdWxlIiwiaWQiLCJsb2FkZWQiLCJjYWxsIiwibSIsImMiLCJwIiwiX3R5cGVvZiIsIlN5bWJvbCIsIml0ZXJhdG9yIiwib2JqIiwiY29uc3RydWN0b3IiLCJwcm90b3R5cGUiLCJEYXRlUmFuZ2UiLCJ3aW5kb3ciLCJkciIsImVudiIsImZhY3RvcnkiLCJkb2N1bWVudCIsIndpbiIsIkVycm9yIiwiRGF0ZVJhbmdlQ2hvb3NlciIsInVuZGVmaW5lZCIsIl93aW5kb3ciLCJ3aW5kb3dFeGlzdHMiLCJGQyIsIkZ1c2lvbkNoYXJ0cyIsInJlZ2lzdGVyIiwicmVnaXN0ZXJDb21wb25lbnQiLCJ3ZWJwYWNrUG9seWZpbGwiLCJkZXByZWNhdGUiLCJwYXRocyIsImNoaWxkcmVuIiwiX2NsYXNzQ2FsbENoZWNrIiwiaW5zdGFuY2UiLCJDb25zdHJ1Y3RvciIsIlR5cGVFcnJvciIsIl9jcmVhdGVDbGFzcyIsImRlZmluZVByb3BlcnRpZXMiLCJ0YXJnZXQiLCJwcm9wcyIsImkiLCJsZW5ndGgiLCJkZXNjcmlwdG9yIiwiZW51bWVyYWJsZSIsImNvbmZpZ3VyYWJsZSIsIndyaXRhYmxlIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJrZXkiLCJwcm90b1Byb3BzIiwic3RhdGljUHJvcHMiLCJ0aGlzIiwic3RhcnREdCIsImVuZER0Iiwic3RhcnREYXRhc2V0IiwiZW5kRGF0YXNldCIsIkZ1c2lvbmNoYXJ0cyIsInRvb2xib3giLCJnZXRDb21wb25lbnQiLCJIb3Jpem9udGFsVG9vbGJhciIsIkNvbXBvbmVudEdyb3VwIiwiU3ltYm9sU3RvcmUiLCJzdGFydFRleHQiLCJhdHRyIiwiZW5kVGV4dCIsInZhbHVlIiwidGVtcCIsImRhdGVSYW5nZSIsInN0YXJ0RGF0ZSIsImVuZERhdGUiLCJ0aW1lc3RhbXAiLCJjaGFydCIsImdldEZvcm1hdHRlZERhdGUiLCJkYXRlU3RyaW5nIiwiZ2V0VGltZXN0YW1wIiwiY29uZmlnT2JqIiwiY2FsZW5kYXJWaXNpYmxlIiwicmVxdWlyZSIsInhBeGlzIiwieUF4aXMiLCJncmFwaGljcyIsImRhdGFzZXQiLCJwbG90TWFuYWdlciIsImNhbnZhc0NvbmZpZyIsIm1hcmtlck1hbmFnZXIiLCJyZWFjdGl2ZU1vZGVsIiwiZ2xvYmFsUmVhY3RpdmVNb2RlbCIsInNwYWNlTWFuYWdlckluc3RhbmNlIiwic21hcnRMYWJlbCIsIm1vZGVsIiwidG9vbGJhcnMiLCJtZWFzdXJlbWVudCIsInB1c2giLCJjcmVhdGVUb29sYmFyIiwidG9vbGJhciIsImZyb21EYXRlTGFiZWwiLCJ0b0RhdGVMYWJlbCIsImdyb3VwIiwiZnJvbUZvcm1hdHRlZERhdGUiLCJ0b0Zvcm1hdHRlZERhdGUiLCJzZWxmIiwiZnJvbURhdGUiLCJ0b0RhdGUiLCJEYXRlIiwidG9Mb2NhbGVEYXRlU3RyaW5nIiwicGFwZXIiLCJjaGFydENvbnRhaW5lciIsImNvbnRhaW5lciIsInNldENvbmZpZyIsImZpbGwiLCJib3JkZXJUaGlja25lc3MiLCJMYWJlbCIsInRleHQiLCJzdHlsZSIsImZvbnQtc2l6ZSIsImZvbnRGYW1pbHkiLCJJbnB1dFRleHRCb3hTeW1ib2wiLCJ3aWR0aCIsImhlaWdodCIsInN0cm9rZVdpZHRoIiwic3Ryb2tlIiwic3ltYm9sU3Ryb2tlV2lkdGgiLCJidG5UZXh0U3R5bGUiLCJmb250U2l6ZSIsImxhYmVsIiwiYXR0YWNoRXZlbnRIYW5kbGVycyIsImNsaWNrIiwiZm4iLCJlZGl0IiwidGV4dE9uQmx1ciIsImJsdXIiLCJnZXRUZXh0IiwiY29uc29sZSIsImxvZyIsIngiLCJ5IiwicmFkIiwidyIsImgiLCJwYWRYIiwicGFkWSIsIngxIiwieDIiLCJ5MSIsInkyIiwiYWRkU3ltYm9sIiwiYWRkQ29tcG9uZW50IiwiYXZhaWxhYmxlV2lkdGgiLCJhdmFpbGFibGVIZWlnaHQiLCJsb2dpY2FsU3BhY2UiLCJsbiIsImdldExvZ2ljYWxTcGFjZSIsIk1hdGgiLCJtYXgiLCJwYWRkaW5nIiwiYWRkIiwibmFtZSIsInJlZiIsInByaW9yaXR5IiwibGF5b3V0IiwiaW5saW5lIiwib3JpZW50YXRpb24iLCJ0eXBlIiwiaG9yaXpvbnRhbCIsInBvc2l0aW9uIiwidG9wIiwiYWxpZ25tZW50IiwibGVmdCIsImRpbWVuc2lvbnMiLCJwYXJlbnQiLCJnZXRQYXJlbnRDb21wb25lbnRHcm91cCIsImdldFdpZHRoIiwiZ2V0SGVpZ2h0IiwibWVzIiwicGFyZW50R3JvdXAiLCJkcmF3Iiwib25Qcm9wc0NoYW5nZSIsInN0YXJ0IiwiZW5kIiwiZ2V0Iiwic2V0Iiwic3RhcnRUaW1lc3RhbXAiLCJlbmRUaW1lc3RhbXAiLCJTdGFuZGFyZFBlcmlvZCJdLCJtYXBwaW5ncyI6IkNBQVMsU0FBVUEsR0NJbkIsUUFBQUMsR0FBQUMsR0FHQSxHQUFBQyxFQUFBRCxHQUNBLE1BQUFDLEdBQUFELEdBQUFFLE9BR0EsSUFBQUMsR0FBQUYsRUFBQUQsSUFDQUUsV0FDQUUsR0FBQUosRUFDQUssUUFBQSxFQVVBLE9BTkFQLEdBQUFFLEdBQUFNLEtBQUFILEVBQUFELFFBQUFDLElBQUFELFFBQUFILEdBR0FJLEVBQUFFLFFBQUEsRUFHQUYsRUFBQUQsUUF2QkEsR0FBQUQsS0FxQ0EsT0FUQUYsR0FBQVEsRUFBQVQsRUFHQUMsRUFBQVMsRUFBQVAsRUFHQUYsRUFBQVUsRUFBQSxHQUdBVixFQUFBLEtETU0sU0FBU0ksRUFBUUQsRUFBU0gsSUU1Q2hDLFNBQUFJLEdBQUEs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a0ZuQ3hELElBQUssWUFDTG1JLElBQUssV0lyY04sTUFBT2hJLE1BQUtDLFNKd2NYZ0ksSUFBSyxTSXJjT2hJLEdBQ2IsR0FBSWlJLElBQWtCLEdBQUk5RSxNQUFLbkQsRUFDM0JpSSxJQUFrQmxJLEtBQUtFLFFBQ3pCRixLQUFLQyxRQUFVaUksRUFDZmxJLEtBQUttQyxvQkFBb0JHLE1BQU0sOEJBQWdDdEMsS0FBS0MsWUp5Y3JFSixJQUFLLFVBQ0xtSSxJQUFLLFdJcmNOLE1BQU9oSSxNQUFLRSxPSndjWCtILElBQUssU0lyY0svSCxHQUNYLEdBQUlpSSxJQUFnQixHQUFJL0UsTUFBS2xELEVBQ3pCaUksSUFBZ0JuSSxLQUFLQyxVQUN2QkQsS0FBS0UsTUFBUWlJLEVBQ2JuSSxLQUFLbUMsb0JBQW9CRyxNQUFNLDRCQUE4QnRDLEtBQUtFLFdKMGM5RHpDLElJdEdZLG9CQUFYYixJQUFvRCxtQkFBbkJBLEdBQU9ELFFBQ2pEQyxFQUFPRCxRQUFVYyxFQUVqQkMsT0FBTzBLLGVBQWlCM0siLCJmaWxlIjoiZmN0cy1leHQtZGF0ZXJhbmdlLWVzNS5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKioqKioqLyAoZnVuY3Rpb24obW9kdWxlcykgeyAvLyB3ZWJwYWNrQm9vdHN0cmFwXG4vKioqKioqLyBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbi8qKioqKiovIFx0dmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTtcbi8qKioqKiovXG4vKioqKioqLyBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4vKioqKioqLyBcdGZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcbi8qKioqKiovXG4vKioqKioqLyBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4vKioqKioqLyBcdFx0aWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pXG4vKioqKioqLyBcdFx0XHRyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0cztcbi8qKioqKiovXG4vKioqKioqLyBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbi8qKioqKiovIFx0XHR2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7XG4vKioqKioqLyBcdFx0XHRleHBvcnRzOiB7fSxcbi8qKioqKiovIFx0XHRcdGlkOiBtb2R1bGVJZCxcbi8qKioqKiovIFx0XHRcdGxvYWRlZDogZmFsc2Vcbi8qKioqKiovIFx0XHR9O1xuLyoqKioqKi9cbi8qKioqKiovIFx0XHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cbi8qKioqKiovIFx0XHRtb2R1bGVzW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcbi8qKioqKiovXG4vKioqKioqLyBcdFx0Ly8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZFxuLyoqKioqKi8gXHRcdG1vZHVsZS5sb2FkZWQgPSB0cnVlO1xuLyoqKioqKi9cbi8qKioqKiovIFx0XHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuLyoqKioqKi8gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbi8qKioqKiovIFx0fVxuLyoqKioqKi9cbi8qKioqKiovXG4vKioqKioqLyBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4vKioqKioqLyBcdF9fd2VicGFja19yZXF1aXJlX18ubSA9IG1vZHVsZXM7XG4vKioqKioqL1xuLyoqKioqKi8gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuLyoqKioqKi8gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmMgPSBpbnN0YWxsZWRNb2R1bGVzO1xuLyoqKioqKi9cbi8qKioqKiovIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbi8qKioqKiovIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjtcbi8qKioqKiovXG4vKioqKioqLyBcdC8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuLyoqKioqKi8gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXygwKTtcbi8qKioqKiovIH0pXG4vKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqL1xuLyoqKioqKi8gKFtcbi8qIDAgKi9cbi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXykge1xuXG5cdC8qIFdFQlBBQ0sgVkFSIElOSkVDVElPTiAqLyhmdW5jdGlvbihtb2R1bGUpIHsndXNlIHN0cmljdCc7XG5cdFxuXHR2YXIgX3R5cGVvZiA9IHR5cGVvZiBTeW1ib2wgPT09IFwiZnVuY3Rpb25cIiAmJiB0eXBlb2YgU3ltYm9sLml0ZXJhdG9yID09PSBcInN5bWJvbFwiID8gZnVuY3Rpb24gKG9iaikgeyByZXR1cm4gdHlwZW9mIG9iajsgfSA6IGZ1bmN0aW9uIChvYmopIHsgcmV0dXJuIG9iaiAmJiB0eXBlb2YgU3ltYm9sID09PSBcImZ1bmN0aW9uXCIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBTeW1ib2wgJiYgb2JqICE9PSBTeW1ib2wucHJvdG90eXBlID8gXCJzeW1ib2xcIiA6IHR5cGVvZiBvYmo7IH07XG5cdFxuXHR2YXIgRGF0ZVJhbmdlID0gX193ZWJwYWNrX3JlcXVpcmVfXygyKTtcblx0XG5cdHdpbmRvdy5kciA9IG5ldyBEYXRlUmFuZ2UoKTtcblx0XG5cdDsoZnVuY3Rpb24gKGVudiwgZmFjdG9yeSkge1xuXHQgIGlmICgoIGZhbHNlID8gJ3VuZGVmaW5lZCcgOiBfdHlwZW9mKG1vZHVsZSkpID09PSAnb2JqZWN0JyAmJiBtb2R1bGUuZXhwb3J0cykge1xuXHQgICAgbW9kdWxlLmV4cG9ydHMgPSBlbnYuZG9jdW1lbnQgPyBmYWN0b3J5KGVudikgOiBmdW5jdGlvbiAod2luKSB7XG5cdCAgICAgIGlmICghd2luLmRvY3VtZW50KSB7XG5cdCAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdXaW5kb3cgd2l0aCBkb2N1bWVudCBub3QgcHJlc2VudCcpO1xuXHQgICAgICB9XG5cdCAgICAgIHJldHVybiBmYWN0b3J5KHdpbiwgdHJ1ZSk7XG5cdCAgICB9O1xuXHQgIH0gZWxzZSB7XG5cdCAgICBlbnYuRGF0ZVJhbmdlQ2hvb3NlciA9IGZhY3RvcnkoZW52LCB0cnVlKTtcblx0ICB9XG5cdH0pKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnID8gd2luZG93IDogdW5kZWZpbmVkLCBmdW5jdGlvbiAoX3dpbmRvdywgd2luZG93RXhpc3RzKSB7XG5cdCAgdmFyIEZDID0gX3dpbmRvdy5GdXNpb25DaGFydHM7XG5cdCAgRkMucmVnaXN0ZXIoJ2V4dGVuc2lvbicsIFsncHJpdmF0ZScsICdEYXRlUmFuZ2VDaG9vc2VyJywgZnVuY3Rpb24gKCkge1xuXHQgICAgRkMucmVnaXN0ZXJDb21wb25lbnQoJ2V4dGVuc2lvbnMnLCAnRGF0ZVJhbmdlQ2hvb3NlcicsIERhdGVSYW5nZSk7XG5cdCAgfV0pO1xuXHR9KTtcblx0LyogV0VCUEFDSyBWQVIgSU5KRUNUSU9OICovfS5jYWxsKGV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18oMSkobW9kdWxlKSkpXG5cbi8qKiovIH0sXG4vKiAxICovXG4vKioqLyBmdW5jdGlvbihtb2R1bGUsIGV4cG9ydHMpIHtcblxuXHRtb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKG1vZHVsZSkge1xuXHRcdGlmKCFtb2R1bGUud2VicGFja1BvbHlmaWxsKSB7XG5cdFx0XHRtb2R1bGUuZGVwcmVjYXRlID0gZnVuY3Rpb24oKSB7fTtcblx0XHRcdG1vZHVsZS5wYXRocyA9IFtdO1xuXHRcdFx0Ly8gbW9kdWxlLnBhcmVudCA9IHVuZGVmaW5lZCBieSBkZWZhdWx0XG5cdFx0XHRtb2R1bGUuY2hpbGRyZW4gPSBbXTtcblx0XHRcdG1vZHVsZS53ZWJwYWNrUG9seWZpbGwgPSAxO1xuXHRcdH1cblx0XHRyZXR1cm4gbW9kdWxlO1xuXHR9XG5cblxuLyoqKi8gfSxcbi8qIDIgKi9cbi8qKiovIGZ1bmN0aW9uKG1vZHVsZSwgZXhwb3J0cykge1xuXG5cdCd1c2Ugc3RyaWN0Jztcblx0LyoqXG5cdCAqIENsYXNzIHJlcHJlc2VudGluZyB0aGUgRGF0ZVJhbmdlLlxuXHQgKi9cblx0XG5cdHZhciBfY3JlYXRlQ2xhc3MgPSBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoXCJ2YWx1ZVwiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfSByZXR1cm4gZnVuY3Rpb24gKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9OyB9KCk7XG5cdFxuXHRmdW5jdGlvbiBfY2xhc3NDYWxsQ2hlY2soaW5zdGFuY2UsIENvbnN0cnVjdG9yKSB7IGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7IHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb25cIik7IH0gfVxuXHRcblx0dmFyIERhdGVSYW5nZSA9IGZ1bmN0aW9uICgpIHtcblx0ICBmdW5jdGlvbiBEYXRlUmFuZ2UoKSB7XG5cdCAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgRGF0ZVJhbmdlKTtcblx0XG5cdCAgICAvKipcblx0ICAgICAqIEBwcml2YXRlXG5cdCAgICAgKi9cblx0XG5cdCAgICB0aGlzLnN0YXJ0RHQgPSAwO1xuXHQgICAgdGhpcy5lbmREdCA9IDA7XG5cdCAgICB0aGlzLnN0YXJ0RGF0YXNldCA9IDA7XG5cdCAgICB0aGlzLmVuZERhdGFzZXQgPSAwO1xuXHQgICAgaWYgKHR5cGVvZiBGdXNpb25jaGFydHMgPT09ICdmdW5jdGlvbicpIHtcblx0ICAgICAgdGhpcy50b29sYm94ID0gRnVzaW9uQ2hhcnRzLmdldENvbXBvbmVudCgnYXBpJywgJ3Rvb2xib3gnKTtcblx0ICAgICAgdGhpcy5Ib3Jpem9udGFsVG9vbGJhciA9IHRoaXMudG9vbGJveC5Ib3Jpem9udGFsVG9vbGJhcjtcblx0ICAgICAgdGhpcy5Db21wb25lbnRHcm91cCA9IHRoaXMudG9vbGJveC5Db21wb25lbnRHcm91cDtcblx0ICAgICAgdGhpcy5TeW1ib2xTdG9yZSA9IHRoaXMudG9vbGJveC5TeW1ib2xTdG9yZTtcblx0ICAgIH1cblx0ICAgIHRoaXMuc3RhcnRUZXh0ID0ge1xuXHQgICAgICBhdHRyOiBmdW5jdGlvbiBhdHRyKCkge31cblx0ICAgIH07XG5cdCAgICB0aGlzLmVuZFRleHQgPSB7XG5cdCAgICAgIGF0dHI6IGZ1bmN0aW9uIGF0dHIoKSB7fVxuXHQgICAgfTtcblx0ICB9XG5cdFxuXHQgIC8qKlxuXHQgICAqIEFuIG9iamVjdCByZXByZXNlbnRpbmcgdGhlIHN0YXJ0IGFuZCBlbmQgZGF0ZXMuXG5cdCAgICogQHR5cGUge0RhdGVSYW5nZS5yYW5nZX1cblx0ICAgKi9cblx0XG5cdFxuXHQgIF9jcmVhdGVDbGFzcyhEYXRlUmFuZ2UsIFt7XG5cdCAgICBrZXk6ICdzd2FwRGF0ZXMnLFxuXHRcblx0XG5cdCAgICAvKipcblx0ICAgICAqIFN3YXBzIHRoZSBzdGFydCBkYXRlIGFuZCB0aGUgZW5kIGRhdGUgb2YgdGhlIGRhdGUgcmFuZ2Vcblx0ICAgICAqIEBwcml2YXRlXG5cdCAgICAgKi9cblx0ICAgIHZhbHVlOiBmdW5jdGlvbiBzd2FwRGF0ZXMoKSB7XG5cdCAgICAgIHZhciB0ZW1wID0gdGhpcy5kYXRlUmFuZ2Uuc3RhcnREYXRlO1xuXHQgICAgICB0aGlzLmRhdGVSYW5nZS5zdGFydERhdGUgPSB0aGlzLmRhdGVSYW5nZS5lbmREYXRlO1xuXHQgICAgICB0aGlzLmRhdGVSYW5nZS5lbmREYXRlID0gdGVtcDtcblx0ICAgIH1cblx0XG5cdCAgICAvKipcblx0ICAgICAqIFN5bmNzIHRoZSBkYXRlcmFuZ2Ugc2hvd24gYnkgdGhlIEZ1c2lvbkNoYXJ0cyB0aW1lIHNlcmllcyBjaGFydCBhbmQgdGhlIERhdGUgUmFuZ2UgQ2hvb3NlclxuXHQgICAgICogQHByaXZhdGVcblx0ICAgICAqL1xuXHRcblx0ICB9LCB7XG5cdCAgICBrZXk6ICdzeW5jUmFuZ2UnLFxuXHQgICAgdmFsdWU6IGZ1bmN0aW9uIHN5bmNSYW5nZSgpIHt9XG5cdFxuXHQgICAgLyoqXG5cdCAgICAgKiBSZXR1cm5zIGEgZm9ybWF0dGVkIGRhdGUgc3RyaW5nIGZyb20gRnVzaW9uQ2hhcnRzIHdoZW4gZ2l2ZW4gYSBVTklYIHRpbWVzdGFtcFxuXHQgICAgICogQHBhcmFtICB7bnVtYmVyfSB0aW1lc3RhbXAgLSBBIFVOSVggdGltZXN0YW1wIHRvIGJlIGNvbnZlcnRlZCB0byBhIGRhdGUgc3RyaW5nXG5cdCAgICAgKiBAcmV0dXJuIHtzdHJpbmd9IC0gQSBkYXRlIHN0cmluZyB3aGljaCBpcyBlcXVpdmFsZW50IHRvIHRoZSBnaXZlbiB0aW1lc3RhbXBcblx0ICAgICAqL1xuXHRcblx0ICB9LCB7XG5cdCAgICBrZXk6ICdnZXRGb3JtYXR0ZWREYXRlJyxcblx0ICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRGb3JtYXR0ZWREYXRlKHRpbWVzdGFtcCkge1xuXHQgICAgICByZXR1cm4gdGhpcy5jaGFydC5nZXRGb3JtYXR0ZWREYXRlKHRpbWVzdGFtcCk7XG5cdCAgICB9XG5cdFxuXHQgICAgLyoqXG5cdCAgICAgKiBSZXR1cm5zIGEgVU5JWCB0aW1lc3RhbXAgZnJvbSBGdXNpb25DaGFydHMgd2hlbiBnaXZlbiBhIGZvcm1hdHRlZCBkYXRlIHN0cmluZ1xuXHQgICAgICogQHBhcmFtICB7c3RyaW5nfSBkYXRlU3RyaW5nIC0gQSBkYXRlIHN0cmluZyB0byBiZSBjb252ZXJ0ZWQgdG8gYSBVTklYIHRpbWVzdGFtcFxuXHQgICAgICogQHJldHVybiB7bnVtYmVyfSBBIFVOSVggdGltZXN0YW1wIHdoaWNoIGlzIGVxdWl2YWxlbnQgdG8gdGhlIGdpdmVuIGRhdGUgc3RyaW5nXG5cdCAgICAgKi9cblx0XG5cdCAgfSwge1xuXHQgICAga2V5OiAnZ2V0VGltZXN0YW1wJyxcblx0ICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRUaW1lc3RhbXAoZGF0ZVN0cmluZykge1xuXHQgICAgICByZXR1cm4gdGhpcy5jaGFydC5nZXRUaW1lc3RhbXAoZGF0ZVN0cmluZyk7XG5cdCAgICB9XG5cdFxuXHQgICAgLyoqXG5cdCAgICAgKiBTZXRzIHRoZSBjb25maWd1cmFibGUgb3B0aW9ucyBvZiB0aGUgZXh0ZW5zaW9uIChlLmcuIGNvc21ldGljcylcblx0ICAgICAqIEBwYXJhbSB7T2JqZWN0fSBjb25maWdPYmogVGhlIGNvbmZpZ3VyYXRpb24gb2JqZWN0IGNvbnRhaW5pbmcgdmFyaW91cyBleHRlbnNpb24gb3B0aW9uc1xuXHQgICAgICovXG5cdFxuXHQgIH0sIHtcblx0ICAgIGtleTogJ3NldENvbmZpZycsXG5cdCAgICB2YWx1ZTogZnVuY3Rpb24gc2V0Q29uZmlnKGNvbmZpZ09iaikge31cblx0XG5cdCAgICAvKipcblx0ICAgICAqIEdldHMgdGhlIGNvbmZpZ3VyYWJsZSBvcHRpb25zIG9mIHRoZSBleHRlbnNpb24gKGUuZy4gY29zbWV0aWNzKVxuXHQgICAgICogQHJldHVybiB7b2JqZWN0fSBjb25maWdPYmogVGhlIGNvbmZpZ3VyYXRpb24gb2JqZWN0IGNvbnRhaW5pbmcgdmFyaW91cyBleHRlbnNpb24gb3B0aW9uc1xuXHQgICAgICovXG5cdFxuXHQgIH0sIHtcblx0ICAgIGtleTogJ2dldENvbmZpZycsXG5cdCAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0Q29uZmlnKCkge1xuXHQgICAgICByZXR1cm4ge1xuXHQgICAgICAgIGNhbGVuZGFyVmlzaWJsZTogJ2ZhbHNlJ1xuXHQgICAgICB9O1xuXHQgICAgfVxuXHRcblx0ICAgIC8qKlxuXHQgICAgICogRnVzaW9uY2hhcnRzIGxpZmUgY3ljbGUgbWV0aG9kIGZvciBleHRlbnNpb25cblx0ICAgICAqL1xuXHRcblx0ICB9LCB7XG5cdCAgICBrZXk6ICdpbml0Jyxcblx0ICAgIHZhbHVlOiBmdW5jdGlvbiBpbml0KHJlcXVpcmUpIHtcblx0ICAgICAgdmFyIGluc3RhbmNlID0gdGhpcztcblx0ICAgICAgcmVxdWlyZShbJ3hBeGlzJywgJ3lBeGlzJywgJ2dyYXBoaWNzJywgJ2NoYXJ0JywgJ2RhdGFzZXQnLCAnUGxvdE1hbmFnZXInLCAnY2FudmFzQ29uZmlnJywgJ01hcmtlck1hbmFnZXInLCAncmVhY3RpdmVNb2RlbCcsICdnbG9iYWxSZWFjdGl2ZU1vZGVsJywgJ3NwYWNlTWFuYWdlckluc3RhbmNlJywgJ3NtYXJ0TGFiZWwnLCAnY2hhcnRJbnN0YW5jZScsIGZ1bmN0aW9uICh4QXhpcywgeUF4aXMsIGdyYXBoaWNzLCBjaGFydCwgZGF0YXNldCwgcGxvdE1hbmFnZXIsIGNhbnZhc0NvbmZpZywgbWFya2VyTWFuYWdlciwgcmVhY3RpdmVNb2RlbCwgZ2xvYmFsUmVhY3RpdmVNb2RlbCwgc3BhY2VNYW5hZ2VySW5zdGFuY2UsIHNtYXJ0TGFiZWwpIHtcblx0ICAgICAgICBpbnN0YW5jZS54QXhpcyA9IHhBeGlzO1xuXHQgICAgICAgIGluc3RhbmNlLnlBeGlzID0geUF4aXM7XG5cdCAgICAgICAgaW5zdGFuY2UuZ3JhcGhpY3MgPSBncmFwaGljcztcblx0ICAgICAgICBpbnN0YW5jZS5jaGFydCA9IGNoYXJ0O1xuXHQgICAgICAgIGluc3RhbmNlLmRhdGFzZXQgPSBkYXRhc2V0O1xuXHQgICAgICAgIGluc3RhbmNlLnBsb3RNYW5hZ2VyID0gcGxvdE1hbmFnZXI7XG5cdCAgICAgICAgaW5zdGFuY2UubWFya2VyTWFuYWdlciA9IG1hcmtlck1hbmFnZXI7XG5cdCAgICAgICAgaW5zdGFuY2UuY2FudmFzQ29uZmlnID0gY2FudmFzQ29uZmlnO1xuXHQgICAgICAgIGluc3RhbmNlLnJlYWN0aXZlTW9kZWwgPSByZWFjdGl2ZU1vZGVsO1xuXHQgICAgICAgIGluc3RhbmNlLmdsb2JhbFJlYWN0aXZlTW9kZWwgPSBnbG9iYWxSZWFjdGl2ZU1vZGVsO1xuXHQgICAgICAgIGluc3RhbmNlLnNwYWNlTWFuYWdlckluc3RhbmNlID0gc3BhY2VNYW5hZ2VySW5zdGFuY2U7XG5cdCAgICAgICAgaW5zdGFuY2Uuc21hcnRMYWJlbCA9IHNtYXJ0TGFiZWw7XG5cdCAgICAgIH1dKTtcblx0ICAgICAgdGhpcy5zcGFjZU1hbmFnZXJJbnN0YW5jZSA9IGluc3RhbmNlLnNwYWNlTWFuYWdlckluc3RhbmNlO1xuXHQgICAgICB0aGlzLmdsb2JhbFJlYWN0aXZlTW9kZWwgPSBpbnN0YW5jZS5nbG9iYWxSZWFjdGl2ZU1vZGVsO1xuXHQgICAgICB0aGlzLnN0YXJ0RHQgPSBpbnN0YW5jZS5nbG9iYWxSZWFjdGl2ZU1vZGVsLm1vZGVsWyd4LWF4aXMtdmlzaWJsZS1yYW5nZS1zdGFydCddO1xuXHQgICAgICB0aGlzLmVuZER0ID0gaW5zdGFuY2UuZ2xvYmFsUmVhY3RpdmVNb2RlbC5tb2RlbFsneC1heGlzLXZpc2libGUtcmFuZ2UtZW5kJ107XG5cdCAgICAgIHRoaXMuc3RhcnREYXRhc2V0ID0gaW5zdGFuY2UuZ2xvYmFsUmVhY3RpdmVNb2RlbC5tb2RlbFsneC1heGlzLWFic29sdXRlLXJhbmdlLXN0YXJ0J107XG5cdCAgICAgIHRoaXMuZW5kRGF0YXNldCA9IGluc3RhbmNlLmdsb2JhbFJlYWN0aXZlTW9kZWwubW9kZWxbJ3gtYXhpcy1hYnNvbHV0ZS1yYW5nZS1lbmQnXTtcblx0ICAgICAgdGhpcy50b29sYmFycyA9IFtdO1xuXHQgICAgICB0aGlzLm1lYXN1cmVtZW50ID0ge307XG5cdCAgICAgIHRoaXMudG9vbGJhcnMucHVzaCh0aGlzLmNyZWF0ZVRvb2xiYXIoKSk7XG5cdCAgICAgIC8vIGNvbnNvbGUubG9nKHRoaXMuY3JlYXRlVG9vbGJhcigpKTtcblx0ICAgICAgLy8gY29uc29sZS5sb2codGhpcy5kYXRlU3RhcnQsIHRoaXMuZGF0ZUVuZCk7XG5cdCAgICAgIHJldHVybiB0aGlzO1xuXHQgICAgfVxuXHQgIH0sIHtcblx0ICAgIGtleTogJ2NyZWF0ZVRvb2xiYXInLFxuXHQgICAgdmFsdWU6IGZ1bmN0aW9uIGNyZWF0ZVRvb2xiYXIoKSB7XG5cdCAgICAgIHZhciB0b29sYmFyLFxuXHQgICAgICAgICAgc2VsZiA9IHRoaXMsXG5cdCAgICAgICAgICBmcm9tRGF0ZUxhYmVsLFxuXHQgICAgICAgICAgdG9EYXRlTGFiZWwsXG5cdCAgICAgICAgICBncm91cCxcblx0ICAgICAgICAgIGZyb21Gb3JtYXR0ZWREYXRlLFxuXHQgICAgICAgICAgdG9Gb3JtYXR0ZWREYXRlO1xuXHRcblx0ICAgICAgc2VsZi5mcm9tRGF0ZSA9IHt9O1xuXHQgICAgICBzZWxmLnRvRGF0ZSA9IHt9O1xuXHRcblx0ICAgICAgZnJvbUZvcm1hdHRlZERhdGUgPSBuZXcgRGF0ZSh0aGlzLnN0YXJ0RHQpLnRvTG9jYWxlRGF0ZVN0cmluZygpO1xuXHRcblx0ICAgICAgdG9Gb3JtYXR0ZWREYXRlID0gbmV3IERhdGUodGhpcy5lbmREdCkudG9Mb2NhbGVEYXRlU3RyaW5nKCk7XG5cdFxuXHQgICAgICB0b29sYmFyID0gbmV3IHRoaXMuSG9yaXpvbnRhbFRvb2xiYXIoe1xuXHQgICAgICAgIHBhcGVyOiB0aGlzLmdyYXBoaWNzLnBhcGVyLFxuXHQgICAgICAgIGNoYXJ0OiB0aGlzLmNoYXJ0LFxuXHQgICAgICAgIHNtYXJ0TGFiZWw6IHRoaXMuc21hcnRMYWJlbCxcblx0ICAgICAgICBjaGFydENvbnRhaW5lcjogdGhpcy5ncmFwaGljcy5jb250YWluZXJcblx0ICAgICAgfSk7XG5cdFxuXHQgICAgICB0b29sYmFyLnNldENvbmZpZyh7XG5cdCAgICAgICAgZmlsbDogJyNmZmYnLFxuXHQgICAgICAgIGJvcmRlclRoaWNrbmVzczogMFxuXHQgICAgICB9KTtcblx0XG5cdCAgICAgIGdyb3VwID0gbmV3IHRoaXMudG9vbGJveC5Db21wb25lbnRHcm91cCh7XG5cdCAgICAgICAgcGFwZXI6IHRoaXMuZ3JhcGhpY3MucGFwZXIsXG5cdCAgICAgICAgY2hhcnQ6IHRoaXMuY2hhcnQsXG5cdCAgICAgICAgc21hcnRMYWJlbDogdGhpcy5zbWFydExhYmVsLFxuXHQgICAgICAgIGNoYXJ0Q29udGFpbmVyOiB0aGlzLmdyYXBoaWNzLmNvbnRhaW5lclxuXHQgICAgICB9KTtcblx0XG5cdCAgICAgIGdyb3VwLnNldENvbmZpZyh7XG5cdCAgICAgICAgZmlsbDogJyNmZmYnLFxuXHQgICAgICAgIGJvcmRlclRoaWNrbmVzczogMFxuXHQgICAgICB9KTtcblx0XG5cdCAgICAgIGZyb21EYXRlTGFiZWwgPSBuZXcgdGhpcy50b29sYm94LkxhYmVsKCdGcm9tOicsIHtcblx0ICAgICAgICBzbWFydExhYmVsOiB0aGlzLnNtYXJ0TGFiZWwsXG5cdCAgICAgICAgcGFwZXI6IHRoaXMuZ3JhcGhpY3MucGFwZXJcblx0ICAgICAgfSwge1xuXHQgICAgICAgIHRleHQ6IHtcblx0ICAgICAgICAgIHN0eWxlOiB7XG5cdCAgICAgICAgICAgICdmb250LXNpemUnOiAnMTUnLFxuXHQgICAgICAgICAgICAnZm9udEZhbWlseSc6ICdNeXJpYWRQcm8nXG5cdCAgICAgICAgICB9XG5cdCAgICAgICAgfVxuXHQgICAgICB9KTtcblx0XG5cdCAgICAgIHNlbGYuZnJvbURhdGUgPSBuZXcgdGhpcy50b29sYm94LklucHV0VGV4dEJveFN5bWJvbCh7XG5cdCAgICAgICAgd2lkdGg6IDEyMCxcblx0ICAgICAgICBoZWlnaHQ6IDI1XG5cdCAgICAgIH0sIHtcblx0ICAgICAgICBwYXBlcjogdGhpcy5ncmFwaGljcy5wYXBlcixcblx0ICAgICAgICBjaGFydDogdGhpcy5jaGFydCxcblx0ICAgICAgICBzbWFydExhYmVsOiB0aGlzLnNtYXJ0TGFiZWwsXG5cdCAgICAgICAgY2hhcnRDb250YWluZXI6IHRoaXMuZ3JhcGhpY3MuY29udGFpbmVyXG5cdCAgICAgIH0sIHtcblx0ICAgICAgICBzdHJva2VXaWR0aDogMSxcblx0ICAgICAgICBzdHJva2U6ICdyZ2JhKDEwMiwxMDIsMTAyLDAuNSknLFxuXHQgICAgICAgIHN5bWJvbFN0cm9rZVdpZHRoOiAwLFxuXHQgICAgICAgIGJ0blRleHRTdHlsZToge1xuXHQgICAgICAgICAgZm9udFNpemU6IDE0XG5cdCAgICAgICAgfSxcblx0ICAgICAgICBsYWJlbDogZnJvbUZvcm1hdHRlZERhdGVcblx0ICAgICAgfSk7XG5cdFxuXHQgICAgICB0b0RhdGVMYWJlbCA9IG5ldyB0aGlzLnRvb2xib3guTGFiZWwoJ1RvOicsIHtcblx0ICAgICAgICBzbWFydExhYmVsOiB0aGlzLnNtYXJ0TGFiZWwsXG5cdCAgICAgICAgcGFwZXI6IHRoaXMuZ3JhcGhpY3MucGFwZXJcblx0ICAgICAgfSwge1xuXHQgICAgICAgIHRleHQ6IHtcblx0ICAgICAgICAgIHN0eWxlOiB7XG5cdCAgICAgICAgICAgICdmb250LXNpemUnOiAnMTUnLFxuXHQgICAgICAgICAgICAnZm9udEZhbWlseSc6ICdNeXJpYWRQcm8nXG5cdCAgICAgICAgICB9XG5cdCAgICAgICAgfVxuXHQgICAgICB9KTtcblx0XG5cdCAgICAgIHNlbGYudG9EYXRlID0gbmV3IHRoaXMudG9vbGJveC5JbnB1dFRleHRCb3hTeW1ib2woe1xuXHQgICAgICAgIHdpZHRoOiAxMjAsXG5cdCAgICAgICAgaGVpZ2h0OiAyNVxuXHQgICAgICB9LCB7XG5cdCAgICAgICAgcGFwZXI6IHRoaXMuZ3JhcGhpY3MucGFwZXIsXG5cdCAgICAgICAgY2hhcnQ6IHRoaXMuY2hhcnQsXG5cdCAgICAgICAgc21hcnRMYWJlbDogdGhpcy5zbWFydExhYmVsLFxuXHQgICAgICAgIGNoYXJ0Q29udGFpbmVyOiB0aGlzLmdyYXBoaWNzLmNvbnRhaW5lclxuXHQgICAgICB9LCB7XG5cdCAgICAgICAgc3Ryb2tlV2lkdGg6IDEsXG5cdCAgICAgICAgc3Ryb2tlOiAncmdiYSgxMDIsMTAyLDEwMiwwLjUpJyxcblx0ICAgICAgICBzeW1ib2xTdHJva2VXaWR0aDogMCxcblx0ICAgICAgICBidG5UZXh0U3R5bGU6IHtcblx0ICAgICAgICAgIGZvbnRTaXplOiAxNFxuXHQgICAgICAgIH0sXG5cdCAgICAgICAgbGFiZWw6IHRvRm9ybWF0dGVkRGF0ZVxuXHQgICAgICB9KTtcblx0XG5cdCAgICAgIHNlbGYuZnJvbURhdGUuYXR0YWNoRXZlbnRIYW5kbGVycyh7XG5cdCAgICAgICAgY2xpY2s6IHtcblx0ICAgICAgICAgIGZuOiBzZWxmLmZyb21EYXRlLmVkaXRcblx0ICAgICAgICB9LFxuXHQgICAgICAgIHRleHRPbkJsdXI6IGZ1bmN0aW9uIHRleHRPbkJsdXIoKSB7XG5cdCAgICAgICAgICBzZWxmLmZyb21EYXRlLmJsdXIoKTtcblx0ICAgICAgICAgIHNlbGYuc3RhcnREYXRlID0gc2VsZi5mcm9tRGF0ZS5nZXRUZXh0KCk7XG5cdCAgICAgICAgICBjb25zb2xlLmxvZyhzZWxmLmZyb21EYXRlLmdldFRleHQoKSk7XG5cdCAgICAgICAgfVxuXHQgICAgICB9KTtcblx0XG5cdCAgICAgIHNlbGYudG9EYXRlLmF0dGFjaEV2ZW50SGFuZGxlcnMoe1xuXHQgICAgICAgIGNsaWNrOiB7XG5cdCAgICAgICAgICBmbjogc2VsZi50b0RhdGUuZWRpdFxuXHQgICAgICAgIH0sXG5cdCAgICAgICAgdGV4dE9uQmx1cjogZnVuY3Rpb24gdGV4dE9uQmx1cigpIHtcblx0ICAgICAgICAgIHNlbGYudG9EYXRlLmJsdXIoKTtcblx0ICAgICAgICAgIGNvbnNvbGUubG9nKHNlbGYudG9EYXRlLmdldFRleHQoKSk7XG5cdCAgICAgICAgICBzZWxmLmVuZERhdGUgPSBzZWxmLnRvRGF0ZS5nZXRUZXh0KCk7XG5cdCAgICAgICAgfVxuXHQgICAgICB9KTtcblx0XG5cdCAgICAgIHRoaXMuU3ltYm9sU3RvcmUucmVnaXN0ZXIoJ3RleHRCb3hJY29uJywgZnVuY3Rpb24gKHgsIHksIHJhZCwgdywgaCwgcGFkWCwgcGFkWSkge1xuXHQgICAgICAgIHZhciB4MSA9IHggLSB3IC8gMiArIHBhZFggLyAyLFxuXHQgICAgICAgICAgICB4MiA9IHggKyB3IC8gMiAtIHBhZFggLyAyLFxuXHQgICAgICAgICAgICB5MSA9IHkgLSBoIC8gMiArIHBhZFkgLyAyLFxuXHQgICAgICAgICAgICB5MiA9IHkgKyBoIC8gMiAtIHBhZFkgLyAyO1xuXHRcblx0ICAgICAgICByZXR1cm4gWydNJywgeDEsIHkxLCAnTCcsIHgyLCB5MSwgJ0wnLCB4MiwgeTIsICdMJywgeDEsIHkyLCAnWiddO1xuXHQgICAgICB9KTtcblx0XG5cdCAgICAgIGdyb3VwLmFkZFN5bWJvbChmcm9tRGF0ZUxhYmVsKTtcblx0ICAgICAgZ3JvdXAuYWRkU3ltYm9sKHNlbGYuZnJvbURhdGUpO1xuXHQgICAgICBncm91cC5hZGRTeW1ib2wodG9EYXRlTGFiZWwpO1xuXHQgICAgICBncm91cC5hZGRTeW1ib2woc2VsZi50b0RhdGUpO1xuXHQgICAgICB0b29sYmFyLmFkZENvbXBvbmVudChncm91cCk7XG5cdCAgICAgIHJldHVybiB0b29sYmFyO1xuXHQgICAgfVxuXHQgIH0sIHtcblx0ICAgIGtleTogJ2dldExvZ2ljYWxTcGFjZScsXG5cdCAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0TG9naWNhbFNwYWNlKGF2YWlsYWJsZVdpZHRoLCBhdmFpbGFibGVIZWlnaHQpIHtcblx0ICAgICAgYXZhaWxhYmxlV2lkdGggLz0gMjtcblx0ICAgICAgdmFyIGxvZ2ljYWxTcGFjZSxcblx0ICAgICAgICAgIHdpZHRoID0gMCxcblx0ICAgICAgICAgIGhlaWdodCA9IDAsXG5cdCAgICAgICAgICBpLFxuXHQgICAgICAgICAgbG47XG5cdFxuXHQgICAgICBmb3IgKGkgPSAwLCBsbiA9IHRoaXMudG9vbGJhcnMubGVuZ3RoOyBpIDwgbG47IGkrKykge1xuXHQgICAgICAgIGxvZ2ljYWxTcGFjZSA9IHRoaXMudG9vbGJhcnNbaV0uZ2V0TG9naWNhbFNwYWNlKCk7XG5cdCAgICAgICAgd2lkdGggPSBNYXRoLm1heChsb2dpY2FsU3BhY2Uud2lkdGgsIHdpZHRoKTtcblx0ICAgICAgICBoZWlnaHQgKz0gbG9naWNhbFNwYWNlLmhlaWdodDtcblx0ICAgICAgICB0aGlzLnRvb2xiYXJzW2ldLndpZHRoID0gbG9naWNhbFNwYWNlLndpZHRoO1xuXHQgICAgICAgIHRoaXMudG9vbGJhcnNbaV0uaGVpZ2h0ID0gbG9naWNhbFNwYWNlLmhlaWdodDtcblx0ICAgICAgfVxuXHQgICAgICBoZWlnaHQgKz0gdGhpcy5wYWRkaW5nO1xuXHQgICAgICByZXR1cm4ge1xuXHQgICAgICAgIHdpZHRoOiB3aWR0aCA+IGF2YWlsYWJsZVdpZHRoID8gMCA6IHdpZHRoLFxuXHQgICAgICAgIGhlaWdodDogaGVpZ2h0ID4gYXZhaWxhYmxlSGVpZ2h0ID8gMCA6IGhlaWdodFxuXHQgICAgICB9O1xuXHQgICAgfVxuXHQgIH0sIHtcblx0ICAgIGtleTogJ3BsYWNlSW5DYW52YXMnLFxuXHQgICAgdmFsdWU6IGZ1bmN0aW9uIHBsYWNlSW5DYW52YXMoKSB7XG5cdCAgICAgIHZhciBfc2VsZiA9IHRoaXM7XG5cdCAgICAgIF9zZWxmLnBhZGRpbmcgPSA1O1xuXHQgICAgICBfc2VsZi5zcGFjZU1hbmFnZXJJbnN0YW5jZS5hZGQoW3tcblx0ICAgICAgICBuYW1lOiBmdW5jdGlvbiBuYW1lKCkge1xuXHQgICAgICAgICAgcmV0dXJuICdUb29sQm94RXh0Jztcblx0ICAgICAgICB9LFxuXHQgICAgICAgIHJlZjogZnVuY3Rpb24gcmVmKG9iaikge1xuXHQgICAgICAgICAgcmV0dXJuIG9ialsnMCddO1xuXHQgICAgICAgIH0sXG5cdCAgICAgICAgc2VsZjogZnVuY3Rpb24gc2VsZigpIHtcblx0ICAgICAgICAgIHJldHVybiBfc2VsZjtcblx0ICAgICAgICB9LFxuXHQgICAgICAgIHByaW9yaXR5OiBmdW5jdGlvbiBwcmlvcml0eSgpIHtcblx0ICAgICAgICAgIHJldHVybiAyO1xuXHQgICAgICAgIH0sXG5cdCAgICAgICAgbGF5b3V0OiBmdW5jdGlvbiBsYXlvdXQob2JqKSB7XG5cdCAgICAgICAgICByZXR1cm4gb2JqLmlubGluZTtcblx0ICAgICAgICB9LFxuXHQgICAgICAgIG9yaWVudGF0aW9uOiBbe1xuXHQgICAgICAgICAgdHlwZTogZnVuY3Rpb24gdHlwZShvYmopIHtcblx0ICAgICAgICAgICAgcmV0dXJuIG9iai5ob3Jpem9udGFsO1xuXHQgICAgICAgICAgfSxcblx0ICAgICAgICAgIHBvc2l0aW9uOiBbe1xuXHQgICAgICAgICAgICB0eXBlOiBmdW5jdGlvbiB0eXBlKG9iaikge1xuXHQgICAgICAgICAgICAgIHJldHVybiBvYmoudG9wO1xuXHQgICAgICAgICAgICB9LFxuXHQgICAgICAgICAgICBhbGlnbm1lbnQ6IFt7XG5cdCAgICAgICAgICAgICAgdHlwZTogZnVuY3Rpb24gdHlwZShvYmopIHtcblx0ICAgICAgICAgICAgICAgIHJldHVybiBvYmoubGVmdDtcblx0ICAgICAgICAgICAgICB9LFxuXHQgICAgICAgICAgICAgIGRpbWVuc2lvbnM6IFtmdW5jdGlvbiAoKSB7XG5cdCAgICAgICAgICAgICAgICB2YXIgcGFyZW50ID0gdGhpcy5nZXRQYXJlbnRDb21wb25lbnRHcm91cCgpO1xuXHQgICAgICAgICAgICAgICAgcmV0dXJuIF9zZWxmLmdldExvZ2ljYWxTcGFjZShwYXJlbnQuZ2V0V2lkdGgoKSwgcGFyZW50LmdldEhlaWdodCgpKTtcblx0ICAgICAgICAgICAgICB9XVxuXHQgICAgICAgICAgICB9XVxuXHQgICAgICAgICAgfV1cblx0ICAgICAgICB9XVxuXHQgICAgICB9XSk7XG5cdCAgICB9XG5cdCAgfSwge1xuXHQgICAga2V5OiAnc2V0RHJhd2luZ0NvbmZpZ3VyYXRpb24nLFxuXHQgICAgdmFsdWU6IGZ1bmN0aW9uIHNldERyYXdpbmdDb25maWd1cmF0aW9uKHgsIHksIHdpZHRoLCBoZWlnaHQsIGdyb3VwKSB7XG5cdCAgICAgIHZhciBtZXMgPSB0aGlzLm1lYXN1cmVtZW50O1xuXHQgICAgICBtZXMueCA9IHg7XG5cdCAgICAgIG1lcy55ID0geTtcblx0ICAgICAgbWVzLndpZHRoID0gd2lkdGg7XG5cdCAgICAgIG1lcy5oZWlnaHQgPSBoZWlnaHQ7XG5cdFxuXHQgICAgICB0aGlzLnBhcmVudEdyb3VwID0gZ3JvdXA7XG5cdFxuXHQgICAgICByZXR1cm4gdGhpcztcblx0ICAgIH1cblx0ICB9LCB7XG5cdCAgICBrZXk6ICdkcmF3Jyxcblx0ICAgIHZhbHVlOiBmdW5jdGlvbiBkcmF3KHgsIHksIHdpZHRoLCBoZWlnaHQsIGdyb3VwKSB7XG5cdCAgICAgIHZhciBtZWFzdXJlbWVudCA9IHRoaXMubWVhc3VyZW1lbnQsXG5cdCAgICAgICAgICB0b29sYmFycyA9IHRoaXMudG9vbGJhcnMsXG5cdCAgICAgICAgICBsbixcblx0ICAgICAgICAgIGksXG5cdCAgICAgICAgICB0b29sYmFyLFxuXHQgICAgICAgICAgbW9kZWwgPSB0aGlzLmdsb2JhbFJlYWN0aXZlTW9kZWwsXG5cdCAgICAgICAgICBzZWxmID0gdGhpcztcblx0ICAgICAgY29uc29sZS5sb2cobW9kZWwpO1xuXHQgICAgICB4ID0geCA9PT0gdW5kZWZpbmVkID8gbWVhc3VyZW1lbnQueCA6IHg7XG5cdCAgICAgIHkgPSB5ID09PSB1bmRlZmluZWQgPyBtZWFzdXJlbWVudC55IDogeTtcblx0ICAgICAgd2lkdGggPSB3aWR0aCA9PT0gdW5kZWZpbmVkID8gbWVhc3VyZW1lbnQud2lkdGggOiB3aWR0aDtcblx0ICAgICAgaGVpZ2h0ID0gaGVpZ2h0ID09PSB1bmRlZmluZWQgPyBtZWFzdXJlbWVudC5oZWlnaHQgOiBoZWlnaHQ7XG5cdCAgICAgIGdyb3VwID0gZ3JvdXAgPT09IHVuZGVmaW5lZCA/IHRoaXMucGFyZW50R3JvdXAgOiBncm91cDtcblx0ICAgICAgaWYgKHdpZHRoICYmIGhlaWdodCkge1xuXHQgICAgICAgIGZvciAoaSA9IDAsIGxuID0gdG9vbGJhcnMubGVuZ3RoOyBpIDwgbG47IGkrKykge1xuXHQgICAgICAgICAgdG9vbGJhciA9IHRvb2xiYXJzW2ldO1xuXHQgICAgICAgICAgdG9vbGJhci5kcmF3KHgsIHkpO1xuXHQgICAgICAgIH1cblx0ICAgICAgfVxuXHRcblx0ICAgICAgbW9kZWwub25Qcm9wc0NoYW5nZShbJ3gtYXhpcy12aXNpYmxlLXJhbmdlLXN0YXJ0JywgJ3gtYXhpcy12aXNpYmxlLXJhbmdlLWVuZCddLCBmdW5jdGlvbiAoc3RhcnQsIGVuZCkge1xuXHQgICAgICAgIHNlbGYuZnJvbURhdGUuYmx1cihuZXcgRGF0ZShzdGFydFsxXSkudG9Mb2NhbGVEYXRlU3RyaW5nKCkpO1xuXHQgICAgICAgIHNlbGYudG9EYXRlLmJsdXIobmV3IERhdGUoZW5kWzFdKS50b0xvY2FsZURhdGVTdHJpbmcoKSk7XG5cdCAgICAgIH0pO1xuXHQgICAgfVxuXHQgIH0sIHtcblx0ICAgIGtleTogJ3N0YXJ0RGF0ZScsXG5cdCAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHtcblx0ICAgICAgcmV0dXJuIHRoaXMuc3RhcnREdDtcblx0ICAgIH0sXG5cdCAgICBzZXQ6IGZ1bmN0aW9uIHNldChzdGFydER0KSB7XG5cdCAgICAgIHZhciBzdGFydFRpbWVzdGFtcCA9ICtuZXcgRGF0ZShzdGFydER0KTtcblx0ICAgICAgaWYgKHN0YXJ0VGltZXN0YW1wIDw9IHRoaXMuZW5kRHQpIHtcblx0ICAgICAgICB0aGlzLnN0YXJ0RHQgPSBzdGFydFRpbWVzdGFtcDtcblx0ICAgICAgICB0aGlzLmdsb2JhbFJlYWN0aXZlTW9kZWwubW9kZWxbJ3gtYXhpcy12aXNpYmxlLXJhbmdlLXN0YXJ0J10gPSB0aGlzLnN0YXJ0RHQ7XG5cdCAgICAgIH1cblx0ICAgIH1cblx0ICB9LCB7XG5cdCAgICBrZXk6ICdlbmREYXRlJyxcblx0ICAgIGdldDogZnVuY3Rpb24gZ2V0KCkge1xuXHQgICAgICByZXR1cm4gdGhpcy5lbmREdDtcblx0ICAgIH0sXG5cdCAgICBzZXQ6IGZ1bmN0aW9uIHNldChlbmREdCkge1xuXHQgICAgICB2YXIgZW5kVGltZXN0YW1wID0gK25ldyBEYXRlKGVuZER0KTtcblx0ICAgICAgaWYgKGVuZFRpbWVzdGFtcCA+PSB0aGlzLnN0YXJ0RHQpIHtcblx0ICAgICAgICB0aGlzLmVuZER0ID0gZW5kVGltZXN0YW1wO1xuXHQgICAgICAgIHRoaXMuZ2xvYmFsUmVhY3RpdmVNb2RlbC5tb2RlbFsneC1heGlzLXZpc2libGUtcmFuZ2UtZW5kJ10gPSB0aGlzLmVuZER0O1xuXHQgICAgICB9XG5cdCAgICB9XG5cdCAgfV0pO1xuXHRcblx0ICByZXR1cm4gRGF0ZVJhbmdlO1xuXHR9KCk7XG5cdFxuXHRpZiAodHlwZW9mIG1vZHVsZSAhPT0gJ3VuZGVmaW5lZCcgJiYgdHlwZW9mIG1vZHVsZS5leHBvcnRzICE9PSAndW5kZWZpbmVkJykge1xuXHQgIG1vZHVsZS5leHBvcnRzID0gRGF0ZVJhbmdlO1xuXHR9IGVsc2Uge1xuXHQgIHdpbmRvdy5TdGFuZGFyZFBlcmlvZCA9IERhdGVSYW5nZTtcblx0fVxuXG4vKioqLyB9XG4vKioqKioqLyBdKTtcblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gZmN0cy1leHQtZGF0ZXJhbmdlLWVzNS5taW4uanMiLCIgXHQvLyBUaGUgbW9kdWxlIGNhY2hlXG4gXHR2YXIgaW5zdGFsbGVkTW9kdWxlcyA9IHt9O1xuXG4gXHQvLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuIFx0ZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXG4gXHRcdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuIFx0XHRpZihpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSlcbiBcdFx0XHRyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0cztcblxuIFx0XHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuIFx0XHR2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7XG4gXHRcdFx0ZXhwb3J0czoge30sXG4gXHRcdFx0aWQ6IG1vZHVsZUlkLFxuIFx0XHRcdGxvYWRlZDogZmFsc2VcbiBcdFx0fTtcblxuIFx0XHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cbiBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cbiBcdFx0Ly8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZFxuIFx0XHRtb2R1bGUubG9hZGVkID0gdHJ1ZTtcblxuIFx0XHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuIFx0XHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG4gXHR9XG5cblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGVzIG9iamVjdCAoX193ZWJwYWNrX21vZHVsZXNfXylcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubSA9IG1vZHVsZXM7XG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlIGNhY2hlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmMgPSBpbnN0YWxsZWRNb2R1bGVzO1xuXG4gXHQvLyBfX3dlYnBhY2tfcHVibGljX3BhdGhfX1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjtcblxuIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXygwKTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyB3ZWJwYWNrL2Jvb3RzdHJhcCBiNDZmNGVkMTc1ZjIyMjJmZmMxOSIsIid1c2Ugc3RyaWN0JztcbmNvbnN0IERhdGVSYW5nZSA9IHJlcXVpcmUoJy4vZmN0cy1leHQtZGF0ZXJhbmdlJyk7XG5cbndpbmRvdy5kciA9IG5ldyBEYXRlUmFuZ2UoKTtcblxuOyhmdW5jdGlvbiAoZW52LCBmYWN0b3J5KSB7XG4gIGlmICh0eXBlb2YgbW9kdWxlID09PSAnb2JqZWN0JyAmJiBtb2R1bGUuZXhwb3J0cykge1xuICAgIG1vZHVsZS5leHBvcnRzID0gZW52LmRvY3VtZW50XG4gICAgICAgPyBmYWN0b3J5KGVudikgOiBmdW5jdGlvbiAod2luKSB7XG4gICAgICAgICBpZiAoIXdpbi5kb2N1bWVudCkge1xuICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1dpbmRvdyB3aXRoIGRvY3VtZW50IG5vdCBwcmVzZW50Jyk7XG4gICAgICAgICB9XG4gICAgICAgICByZXR1cm4gZmFjdG9yeSh3aW4sIHRydWUpO1xuICAgICAgIH07XG4gIH0gZWxzZSB7XG4gICAgZW52LkRhdGVSYW5nZUNob29zZXIgPSBmYWN0b3J5KGVudiwgdHJ1ZSk7XG4gIH1cbn0pKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnID8gd2luZG93IDogdGhpcywgZnVuY3Rpb24gKF93aW5kb3csIHdpbmRvd0V4aXN0cykge1xuICB2YXIgRkMgPSBfd2luZG93LkZ1c2lvbkNoYXJ0cztcbiAgRkMucmVnaXN0ZXIoJ2V4dGVuc2lvbicsIFsncHJpdmF0ZScsICdEYXRlUmFuZ2VDaG9vc2VyJywgZnVuY3Rpb24gKCkge1xuICAgIEZDLnJlZ2lzdGVyQ29tcG9uZW50KCdleHRlbnNpb25zJywgJ0RhdGVSYW5nZUNob29zZXInLCBEYXRlUmFuZ2UpO1xuICB9XSk7XG59KTtcblxuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyAuL3NyYy9pbmRleC5qcyIsIm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24obW9kdWxlKSB7XG5cdGlmKCFtb2R1bGUud2VicGFja1BvbHlmaWxsKSB7XG5cdFx0bW9kdWxlLmRlcHJlY2F0ZSA9IGZ1bmN0aW9uKCkge307XG5cdFx0bW9kdWxlLnBhdGhzID0gW107XG5cdFx0Ly8gbW9kdWxlLnBhcmVudCA9IHVuZGVmaW5lZCBieSBkZWZhdWx0XG5cdFx0bW9kdWxlLmNoaWxkcmVuID0gW107XG5cdFx0bW9kdWxlLndlYnBhY2tQb2x5ZmlsbCA9IDE7XG5cdH1cblx0cmV0dXJuIG1vZHVsZTtcbn1cblxuXG5cbi8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gV0VCUEFDSyBGT09URVJcbi8vICh3ZWJwYWNrKS9idWlsZGluL21vZHVsZS5qc1xuLy8gbW9kdWxlIGlkID0gMVxuLy8gbW9kdWxlIGNodW5rcyA9IDAiLCIndXNlIHN0cmljdCc7XG4vKipcbiAqIENsYXNzIHJlcHJlc2VudGluZyB0aGUgRGF0ZVJhbmdlLlxuICovXG5jbGFzcyBEYXRlUmFuZ2Uge1xuICBjb25zdHJ1Y3RvciAoKSB7XG4gICAgLyoqXG4gICAgICogQHByaXZhdGVcbiAgICAgKi9cblxuICAgIHRoaXMuc3RhcnREdCA9IDA7XG4gICAgdGhpcy5lbmREdCA9IDA7XG4gICAgdGhpcy5zdGFydERhdGFzZXQgPSAwO1xuICAgIHRoaXMuZW5kRGF0YXNldCA9IDA7XG4gICAgaWYgKHR5cGVvZiBGdXNpb25jaGFydHMgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgIHRoaXMudG9vbGJveCA9IEZ1c2lvbkNoYXJ0cy5nZXRDb21wb25lbnQoJ2FwaScsICd0b29sYm94Jyk7XG4gICAgICB0aGlzLkhvcml6b250YWxUb29sYmFyID0gdGhpcy50b29sYm94Lkhvcml6b250YWxUb29sYmFyO1xuICAgICAgdGhpcy5Db21wb25lbnRHcm91cCA9IHRoaXMudG9vbGJveC5Db21wb25lbnRHcm91cDtcbiAgICAgIHRoaXMuU3ltYm9sU3RvcmUgPSB0aGlzLnRvb2xib3guU3ltYm9sU3RvcmU7XG4gICAgfVxuICAgIHRoaXMuc3RhcnRUZXh0ID0ge1xuICAgICAgYXR0cjogZnVuY3Rpb24gKCkge31cbiAgICB9O1xuICAgIHRoaXMuZW5kVGV4dCA9IHtcbiAgICAgIGF0dHI6IGZ1bmN0aW9uICgpIHt9XG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBbiBvYmplY3QgcmVwcmVzZW50aW5nIHRoZSBzdGFydCBhbmQgZW5kIGRhdGVzLlxuICAgKiBAdHlwZSB7RGF0ZVJhbmdlLnJhbmdlfVxuICAgKi9cbiAgZ2V0IHN0YXJ0RGF0ZSAoKSB7XG4gICAgcmV0dXJuIHRoaXMuc3RhcnREdDtcbiAgfVxuXG4gIHNldCBzdGFydERhdGUgKHN0YXJ0RHQpIHtcbiAgICBsZXQgc3RhcnRUaW1lc3RhbXAgPSArbmV3IERhdGUoc3RhcnREdCk7XG4gICAgaWYgKHN0YXJ0VGltZXN0YW1wIDw9IHRoaXMuZW5kRHQpIHtcbiAgICAgIHRoaXMuc3RhcnREdCA9IHN0YXJ0VGltZXN0YW1wO1xuICAgICAgdGhpcy5nbG9iYWxSZWFjdGl2ZU1vZGVsLm1vZGVsWyd4LWF4aXMtdmlzaWJsZS1yYW5nZS1zdGFydCddID0gdGhpcy5zdGFydER0O1xuICAgIH1cbiAgfVxuXG4gIGdldCBlbmREYXRlICgpIHtcbiAgICByZXR1cm4gdGhpcy5lbmREdDtcbiAgfVxuXG4gIHNldCBlbmREYXRlIChlbmREdCkge1xuICAgIGxldCBlbmRUaW1lc3RhbXAgPSArbmV3IERhdGUoZW5kRHQpO1xuICAgIGlmIChlbmRUaW1lc3RhbXAgPj0gdGhpcy5zdGFydER0KSB7XG4gICAgICB0aGlzLmVuZER0ID0gZW5kVGltZXN0YW1wO1xuICAgICAgdGhpcy5nbG9iYWxSZWFjdGl2ZU1vZGVsLm1vZGVsWyd4LWF4aXMtdmlzaWJsZS1yYW5nZS1lbmQnXSA9IHRoaXMuZW5kRHQ7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFN3YXBzIHRoZSBzdGFydCBkYXRlIGFuZCB0aGUgZW5kIGRhdGUgb2YgdGhlIGRhdGUgcmFuZ2VcbiAgICogQHByaXZhdGVcbiAgICovXG4gIHN3YXBEYXRlcyAoKSB7XG4gICAgbGV0IHRlbXAgPSB0aGlzLmRhdGVSYW5nZS5zdGFydERhdGU7XG4gICAgdGhpcy5kYXRlUmFuZ2Uuc3RhcnREYXRlID0gdGhpcy5kYXRlUmFuZ2UuZW5kRGF0ZTtcbiAgICB0aGlzLmRhdGVSYW5nZS5lbmREYXRlID0gdGVtcDtcbiAgfVxuXG4gIC8qKlxuICAgKiBTeW5jcyB0aGUgZGF0ZXJhbmdlIHNob3duIGJ5IHRoZSBGdXNpb25DaGFydHMgdGltZSBzZXJpZXMgY2hhcnQgYW5kIHRoZSBEYXRlIFJhbmdlIENob29zZXJcbiAgICogQHByaXZhdGVcbiAgICovXG4gIHN5bmNSYW5nZSAoKSB7fVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIGEgZm9ybWF0dGVkIGRhdGUgc3RyaW5nIGZyb20gRnVzaW9uQ2hhcnRzIHdoZW4gZ2l2ZW4gYSBVTklYIHRpbWVzdGFtcFxuICAgKiBAcGFyYW0gIHtudW1iZXJ9IHRpbWVzdGFtcCAtIEEgVU5JWCB0aW1lc3RhbXAgdG8gYmUgY29udmVydGVkIHRvIGEgZGF0ZSBzdHJpbmdcbiAgICogQHJldHVybiB7c3RyaW5nfSAtIEEgZGF0ZSBzdHJpbmcgd2hpY2ggaXMgZXF1aXZhbGVudCB0byB0aGUgZ2l2ZW4gdGltZXN0YW1wXG4gICAqL1xuICBnZXRGb3JtYXR0ZWREYXRlICh0aW1lc3RhbXApIHtcbiAgICByZXR1cm4gdGhpcy5jaGFydC5nZXRGb3JtYXR0ZWREYXRlKHRpbWVzdGFtcCk7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyBhIFVOSVggdGltZXN0YW1wIGZyb20gRnVzaW9uQ2hhcnRzIHdoZW4gZ2l2ZW4gYSBmb3JtYXR0ZWQgZGF0ZSBzdHJpbmdcbiAgICogQHBhcmFtICB7c3RyaW5nfSBkYXRlU3RyaW5nIC0gQSBkYXRlIHN0cmluZyB0byBiZSBjb252ZXJ0ZWQgdG8gYSBVTklYIHRpbWVzdGFtcFxuICAgKiBAcmV0dXJuIHtudW1iZXJ9IEEgVU5JWCB0aW1lc3RhbXAgd2hpY2ggaXMgZXF1aXZhbGVudCB0byB0aGUgZ2l2ZW4gZGF0ZSBzdHJpbmdcbiAgICovXG4gIGdldFRpbWVzdGFtcCAoZGF0ZVN0cmluZykge1xuICAgIHJldHVybiB0aGlzLmNoYXJ0LmdldFRpbWVzdGFtcChkYXRlU3RyaW5nKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXRzIHRoZSBjb25maWd1cmFibGUgb3B0aW9ucyBvZiB0aGUgZXh0ZW5zaW9uIChlLmcuIGNvc21ldGljcylcbiAgICogQHBhcmFtIHtPYmplY3R9IGNvbmZpZ09iaiBUaGUgY29uZmlndXJhdGlvbiBvYmplY3QgY29udGFpbmluZyB2YXJpb3VzIGV4dGVuc2lvbiBvcHRpb25zXG4gICAqL1xuICBzZXRDb25maWcgKGNvbmZpZ09iaikge31cblxuICAvKipcbiAgICogR2V0cyB0aGUgY29uZmlndXJhYmxlIG9wdGlvbnMgb2YgdGhlIGV4dGVuc2lvbiAoZS5nLiBjb3NtZXRpY3MpXG4gICAqIEByZXR1cm4ge29iamVjdH0gY29uZmlnT2JqIFRoZSBjb25maWd1cmF0aW9uIG9iamVjdCBjb250YWluaW5nIHZhcmlvdXMgZXh0ZW5zaW9uIG9wdGlvbnNcbiAgICovXG4gIGdldENvbmZpZyAoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGNhbGVuZGFyVmlzaWJsZTogJ2ZhbHNlJ1xuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogRnVzaW9uY2hhcnRzIGxpZmUgY3ljbGUgbWV0aG9kIGZvciBleHRlbnNpb25cbiAgICovXG4gIGluaXQgKHJlcXVpcmUpIHtcbiAgICB2YXIgaW5zdGFuY2UgPSB0aGlzO1xuICAgIHJlcXVpcmUoW1xuICAgICAgJ3hBeGlzJyxcbiAgICAgICd5QXhpcycsXG4gICAgICAnZ3JhcGhpY3MnLFxuICAgICAgJ2NoYXJ0JyxcbiAgICAgICdkYXRhc2V0JyxcbiAgICAgICdQbG90TWFuYWdlcicsXG4gICAgICAnY2FudmFzQ29uZmlnJyxcbiAgICAgICdNYXJrZXJNYW5hZ2VyJyxcbiAgICAgICdyZWFjdGl2ZU1vZGVsJyxcbiAgICAgICdnbG9iYWxSZWFjdGl2ZU1vZGVsJyxcbiAgICAgICdzcGFjZU1hbmFnZXJJbnN0YW5jZScsXG4gICAgICAnc21hcnRMYWJlbCcsXG4gICAgICAnY2hhcnRJbnN0YW5jZScsXG4gICAgICBmdW5jdGlvbiAoXG4gICAgICAgICAgICB4QXhpcyxcbiAgICAgICAgICAgIHlBeGlzLFxuICAgICAgICAgICAgZ3JhcGhpY3MsXG4gICAgICAgICAgICBjaGFydCxcbiAgICAgICAgICAgIGRhdGFzZXQsXG4gICAgICAgICAgICBwbG90TWFuYWdlcixcbiAgICAgICAgICAgIGNhbnZhc0NvbmZpZyxcbiAgICAgICAgICAgIG1hcmtlck1hbmFnZXIsXG4gICAgICAgICAgICByZWFjdGl2ZU1vZGVsLFxuICAgICAgICAgICAgZ2xvYmFsUmVhY3RpdmVNb2RlbCxcbiAgICAgICAgICAgIHNwYWNlTWFuYWdlckluc3RhbmNlLFxuICAgICAgICAgICAgc21hcnRMYWJlbCkge1xuICAgICAgICBpbnN0YW5jZS54QXhpcyA9IHhBeGlzO1xuICAgICAgICBpbnN0YW5jZS55QXhpcyA9IHlBeGlzO1xuICAgICAgICBpbnN0YW5jZS5ncmFwaGljcyA9IGdyYXBoaWNzO1xuICAgICAgICBpbnN0YW5jZS5jaGFydCA9IGNoYXJ0O1xuICAgICAgICBpbnN0YW5jZS5kYXRhc2V0ID0gZGF0YXNldDtcbiAgICAgICAgaW5zdGFuY2UucGxvdE1hbmFnZXIgPSBwbG90TWFuYWdlcjtcbiAgICAgICAgaW5zdGFuY2UubWFya2VyTWFuYWdlciA9IG1hcmtlck1hbmFnZXI7XG4gICAgICAgIGluc3RhbmNlLmNhbnZhc0NvbmZpZyA9IGNhbnZhc0NvbmZpZztcbiAgICAgICAgaW5zdGFuY2UucmVhY3RpdmVNb2RlbCA9IHJlYWN0aXZlTW9kZWw7XG4gICAgICAgIGluc3RhbmNlLmdsb2JhbFJlYWN0aXZlTW9kZWwgPSBnbG9iYWxSZWFjdGl2ZU1vZGVsO1xuICAgICAgICBpbnN0YW5jZS5zcGFjZU1hbmFnZXJJbnN0YW5jZSA9IHNwYWNlTWFuYWdlckluc3RhbmNlO1xuICAgICAgICBpbnN0YW5jZS5zbWFydExhYmVsID0gc21hcnRMYWJlbDtcbiAgICAgIH1cbiAgICBdKTtcbiAgICB0aGlzLnNwYWNlTWFuYWdlckluc3RhbmNlID0gaW5zdGFuY2Uuc3BhY2VNYW5hZ2VySW5zdGFuY2U7XG4gICAgdGhpcy5nbG9iYWxSZWFjdGl2ZU1vZGVsID0gaW5zdGFuY2UuZ2xvYmFsUmVhY3RpdmVNb2RlbDtcbiAgICB0aGlzLnN0YXJ0RHQgPSBpbnN0YW5jZS5nbG9iYWxSZWFjdGl2ZU1vZGVsLm1vZGVsWyd4LWF4aXMtdmlzaWJsZS1yYW5nZS1zdGFydCddO1xuICAgIHRoaXMuZW5kRHQgPSBpbnN0YW5jZS5nbG9iYWxSZWFjdGl2ZU1vZGVsLm1vZGVsWyd4LWF4aXMtdmlzaWJsZS1yYW5nZS1lbmQnXTtcbiAgICB0aGlzLnN0YXJ0RGF0YXNldCA9IGluc3RhbmNlLmdsb2JhbFJlYWN0aXZlTW9kZWwubW9kZWxbJ3gtYXhpcy1hYnNvbHV0ZS1yYW5nZS1zdGFydCddO1xuICAgIHRoaXMuZW5kRGF0YXNldCA9IGluc3RhbmNlLmdsb2JhbFJlYWN0aXZlTW9kZWwubW9kZWxbJ3gtYXhpcy1hYnNvbHV0ZS1yYW5nZS1lbmQnXTtcbiAgICB0aGlzLnRvb2xiYXJzID0gW107XG4gICAgdGhpcy5tZWFzdXJlbWVudCA9IHt9O1xuICAgIHRoaXMudG9vbGJhcnMucHVzaCh0aGlzLmNyZWF0ZVRvb2xiYXIoKSk7XG4gICAgLy8gY29uc29sZS5sb2codGhpcy5jcmVhdGVUb29sYmFyKCkpO1xuICAgIC8vIGNvbnNvbGUubG9nKHRoaXMuZGF0ZVN0YXJ0LCB0aGlzLmRhdGVFbmQpO1xuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIGNyZWF0ZVRvb2xiYXIgKCkge1xuICAgIHZhciB0b29sYmFyLFxuICAgICAgc2VsZiA9IHRoaXMsXG4gICAgICBmcm9tRGF0ZUxhYmVsLFxuICAgICAgdG9EYXRlTGFiZWwsXG4gICAgICBncm91cCxcbiAgICAgIGZyb21Gb3JtYXR0ZWREYXRlLFxuICAgICAgdG9Gb3JtYXR0ZWREYXRlO1xuXG4gICAgc2VsZi5mcm9tRGF0ZSA9IHt9O1xuICAgIHNlbGYudG9EYXRlID0ge307XG5cbiAgICBmcm9tRm9ybWF0dGVkRGF0ZSA9IG5ldyBEYXRlKHRoaXMuc3RhcnREdCkudG9Mb2NhbGVEYXRlU3RyaW5nKCk7XG5cbiAgICB0b0Zvcm1hdHRlZERhdGUgPSBuZXcgRGF0ZSh0aGlzLmVuZER0KS50b0xvY2FsZURhdGVTdHJpbmcoKTtcblxuICAgIHRvb2xiYXIgPSBuZXcgdGhpcy5Ib3Jpem9udGFsVG9vbGJhcih7XG4gICAgICBwYXBlcjogdGhpcy5ncmFwaGljcy5wYXBlcixcbiAgICAgIGNoYXJ0OiB0aGlzLmNoYXJ0LFxuICAgICAgc21hcnRMYWJlbDogdGhpcy5zbWFydExhYmVsLFxuICAgICAgY2hhcnRDb250YWluZXI6IHRoaXMuZ3JhcGhpY3MuY29udGFpbmVyXG4gICAgfSk7XG5cbiAgICB0b29sYmFyLnNldENvbmZpZyh7XG4gICAgICBmaWxsOiAnI2ZmZicsXG4gICAgICBib3JkZXJUaGlja25lc3M6IDBcbiAgICB9KTtcblxuICAgIGdyb3VwID0gbmV3IHRoaXMudG9vbGJveC5Db21wb25lbnRHcm91cCh7XG4gICAgICBwYXBlcjogdGhpcy5ncmFwaGljcy5wYXBlcixcbiAgICAgIGNoYXJ0OiB0aGlzLmNoYXJ0LFxuICAgICAgc21hcnRMYWJlbDogdGhpcy5zbWFydExhYmVsLFxuICAgICAgY2hhcnRDb250YWluZXI6IHRoaXMuZ3JhcGhpY3MuY29udGFpbmVyXG4gICAgfSk7XG5cbiAgICBncm91cC5zZXRDb25maWcoe1xuICAgICAgZmlsbDogJyNmZmYnLFxuICAgICAgYm9yZGVyVGhpY2tuZXNzOiAwXG4gICAgfSk7XG5cbiAgICBmcm9tRGF0ZUxhYmVsID0gbmV3IHRoaXMudG9vbGJveC5MYWJlbCgnRnJvbTonLCB7XG4gICAgICBzbWFydExhYmVsOiB0aGlzLnNtYXJ0TGFiZWwsXG4gICAgICBwYXBlcjogdGhpcy5ncmFwaGljcy5wYXBlclxuICAgIH0sIHtcbiAgICAgIHRleHQ6IHtcbiAgICAgICAgc3R5bGU6IHtcbiAgICAgICAgICAnZm9udC1zaXplJzogJzE1JyxcbiAgICAgICAgICAnZm9udEZhbWlseSc6ICdNeXJpYWRQcm8nXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHNlbGYuZnJvbURhdGUgPSBuZXcgdGhpcy50b29sYm94LklucHV0VGV4dEJveFN5bWJvbCh7XG4gICAgICB3aWR0aDogMTIwLFxuICAgICAgaGVpZ2h0OiAyNVxuICAgIH0sIHtcbiAgICAgIHBhcGVyOiB0aGlzLmdyYXBoaWNzLnBhcGVyLFxuICAgICAgY2hhcnQ6IHRoaXMuY2hhcnQsXG4gICAgICBzbWFydExhYmVsOiB0aGlzLnNtYXJ0TGFiZWwsXG4gICAgICBjaGFydENvbnRhaW5lcjogdGhpcy5ncmFwaGljcy5jb250YWluZXJcbiAgICB9LCB7XG4gICAgICBzdHJva2VXaWR0aDogMSxcbiAgICAgIHN0cm9rZTogJ3JnYmEoMTAyLDEwMiwxMDIsMC41KScsXG4gICAgICBzeW1ib2xTdHJva2VXaWR0aDogMCxcbiAgICAgIGJ0blRleHRTdHlsZToge1xuICAgICAgICBmb250U2l6ZTogMTRcbiAgICAgIH0sXG4gICAgICBsYWJlbDogZnJvbUZvcm1hdHRlZERhdGVcbiAgICB9KTtcblxuICAgIHRvRGF0ZUxhYmVsID0gbmV3IHRoaXMudG9vbGJveC5MYWJlbCgnVG86Jywge1xuICAgICAgc21hcnRMYWJlbDogdGhpcy5zbWFydExhYmVsLFxuICAgICAgcGFwZXI6IHRoaXMuZ3JhcGhpY3MucGFwZXJcbiAgICB9LCB7XG4gICAgICB0ZXh0OiB7XG4gICAgICAgIHN0eWxlOiB7XG4gICAgICAgICAgJ2ZvbnQtc2l6ZSc6ICcxNScsXG4gICAgICAgICAgJ2ZvbnRGYW1pbHknOiAnTXlyaWFkUHJvJ1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBzZWxmLnRvRGF0ZSA9IG5ldyB0aGlzLnRvb2xib3guSW5wdXRUZXh0Qm94U3ltYm9sKHtcbiAgICAgIHdpZHRoOiAxMjAsXG4gICAgICBoZWlnaHQ6IDI1XG4gICAgfSwge1xuICAgICAgcGFwZXI6IHRoaXMuZ3JhcGhpY3MucGFwZXIsXG4gICAgICBjaGFydDogdGhpcy5jaGFydCxcbiAgICAgIHNtYXJ0TGFiZWw6IHRoaXMuc21hcnRMYWJlbCxcbiAgICAgIGNoYXJ0Q29udGFpbmVyOiB0aGlzLmdyYXBoaWNzLmNvbnRhaW5lclxuICAgIH0sIHtcbiAgICAgIHN0cm9rZVdpZHRoOiAxLFxuICAgICAgc3Ryb2tlOiAncmdiYSgxMDIsMTAyLDEwMiwwLjUpJyxcbiAgICAgIHN5bWJvbFN0cm9rZVdpZHRoOiAwLFxuICAgICAgYnRuVGV4dFN0eWxlOiB7XG4gICAgICAgIGZvbnRTaXplOiAxNFxuICAgICAgfSxcbiAgICAgIGxhYmVsOiB0b0Zvcm1hdHRlZERhdGVcbiAgICB9KTtcblxuICAgIHNlbGYuZnJvbURhdGUuYXR0YWNoRXZlbnRIYW5kbGVycyh7XG4gICAgICBjbGljazoge1xuICAgICAgICBmbjogc2VsZi5mcm9tRGF0ZS5lZGl0XG4gICAgICB9LFxuICAgICAgdGV4dE9uQmx1cjogZnVuY3Rpb24gKCkge1xuICAgICAgICBzZWxmLmZyb21EYXRlLmJsdXIoKTtcbiAgICAgICAgc2VsZi5zdGFydERhdGUgPSBzZWxmLmZyb21EYXRlLmdldFRleHQoKTtcbiAgICAgICAgY29uc29sZS5sb2coc2VsZi5mcm9tRGF0ZS5nZXRUZXh0KCkpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgc2VsZi50b0RhdGUuYXR0YWNoRXZlbnRIYW5kbGVycyh7XG4gICAgICBjbGljazoge1xuICAgICAgICBmbjogc2VsZi50b0RhdGUuZWRpdFxuICAgICAgfSxcbiAgICAgIHRleHRPbkJsdXI6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgc2VsZi50b0RhdGUuYmx1cigpO1xuICAgICAgICBjb25zb2xlLmxvZyhzZWxmLnRvRGF0ZS5nZXRUZXh0KCkpO1xuICAgICAgICBzZWxmLmVuZERhdGUgPSBzZWxmLnRvRGF0ZS5nZXRUZXh0KCk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICB0aGlzLlN5bWJvbFN0b3JlLnJlZ2lzdGVyKCd0ZXh0Qm94SWNvbicsIGZ1bmN0aW9uICh4LCB5LCByYWQsIHcsIGgsIHBhZFgsIHBhZFkpIHtcbiAgICAgIHZhciB4MSA9IHggLSB3IC8gMiArIHBhZFggLyAyLFxuICAgICAgICB4MiA9IHggKyB3IC8gMiAtIHBhZFggLyAyLFxuICAgICAgICB5MSA9IHkgLSBoIC8gMiArIHBhZFkgLyAyLFxuICAgICAgICB5MiA9IHkgKyBoIC8gMiAtIHBhZFkgLyAyO1xuXG4gICAgICByZXR1cm4gWydNJywgeDEsIHkxLCAnTCcsIHgyLCB5MSwgJ0wnLCB4MiwgeTIsICdMJywgeDEsIHkyLCAnWiddO1xuICAgIH0pO1xuXG4gICAgZ3JvdXAuYWRkU3ltYm9sKGZyb21EYXRlTGFiZWwpO1xuICAgIGdyb3VwLmFkZFN5bWJvbChzZWxmLmZyb21EYXRlKTtcbiAgICBncm91cC5hZGRTeW1ib2wodG9EYXRlTGFiZWwpO1xuICAgIGdyb3VwLmFkZFN5bWJvbChzZWxmLnRvRGF0ZSk7XG4gICAgdG9vbGJhci5hZGRDb21wb25lbnQoZ3JvdXApO1xuICAgIHJldHVybiB0b29sYmFyO1xuICB9O1xuXG4gIGdldExvZ2ljYWxTcGFjZSAoYXZhaWxhYmxlV2lkdGgsIGF2YWlsYWJsZUhlaWdodCkge1xuICAgIGF2YWlsYWJsZVdpZHRoIC89IDI7XG4gICAgdmFyIGxvZ2ljYWxTcGFjZSxcbiAgICAgIHdpZHRoID0gMCxcbiAgICAgIGhlaWdodCA9IDAsXG4gICAgICBpLFxuICAgICAgbG47XG5cbiAgICBmb3IgKGkgPSAwLCBsbiA9IHRoaXMudG9vbGJhcnMubGVuZ3RoOyBpIDwgbG47IGkrKykge1xuICAgICAgbG9naWNhbFNwYWNlID0gdGhpcy50b29sYmFyc1tpXS5nZXRMb2dpY2FsU3BhY2UoKTtcbiAgICAgIHdpZHRoID0gTWF0aC5tYXgobG9naWNhbFNwYWNlLndpZHRoLCB3aWR0aCk7XG4gICAgICBoZWlnaHQgKz0gbG9naWNhbFNwYWNlLmhlaWdodDtcbiAgICAgIHRoaXMudG9vbGJhcnNbaV0ud2lkdGggPSBsb2dpY2FsU3BhY2Uud2lkdGg7XG4gICAgICB0aGlzLnRvb2xiYXJzW2ldLmhlaWdodCA9IGxvZ2ljYWxTcGFjZS5oZWlnaHQ7XG4gICAgfVxuICAgIGhlaWdodCArPSB0aGlzLnBhZGRpbmc7XG4gICAgcmV0dXJuIHtcbiAgICAgIHdpZHRoOiB3aWR0aCA+IGF2YWlsYWJsZVdpZHRoID8gMCA6IHdpZHRoLFxuICAgICAgaGVpZ2h0OiBoZWlnaHQgPiBhdmFpbGFibGVIZWlnaHQgPyAwIDogaGVpZ2h0XG4gICAgfTtcbiAgfTtcblxuICBwbGFjZUluQ2FudmFzICgpIHtcbiAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgc2VsZi5wYWRkaW5nID0gNTtcbiAgICBzZWxmLnNwYWNlTWFuYWdlckluc3RhbmNlLmFkZChbe1xuICAgICAgbmFtZTogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gJ1Rvb2xCb3hFeHQnO1xuICAgICAgfSxcbiAgICAgIHJlZjogZnVuY3Rpb24gKG9iaikge1xuICAgICAgICByZXR1cm4gb2JqWycwJ107XG4gICAgICB9LFxuICAgICAgc2VsZjogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gc2VsZjtcbiAgICAgIH0sXG4gICAgICBwcmlvcml0eTogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gMjtcbiAgICAgIH0sXG4gICAgICBsYXlvdXQ6IGZ1bmN0aW9uIChvYmopIHtcbiAgICAgICAgcmV0dXJuIG9iai5pbmxpbmU7XG4gICAgICB9LFxuICAgICAgb3JpZW50YXRpb246IFt7XG4gICAgICAgIHR5cGU6IGZ1bmN0aW9uIChvYmopIHtcbiAgICAgICAgICByZXR1cm4gb2JqLmhvcml6b250YWw7XG4gICAgICAgIH0sXG4gICAgICAgIHBvc2l0aW9uOiBbe1xuICAgICAgICAgIHR5cGU6IGZ1bmN0aW9uIChvYmopIHtcbiAgICAgICAgICAgIHJldHVybiBvYmoudG9wO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgYWxpZ25tZW50OiBbe1xuICAgICAgICAgICAgdHlwZTogZnVuY3Rpb24gKG9iaikge1xuICAgICAgICAgICAgICByZXR1cm4gb2JqLmxlZnQ7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZGltZW5zaW9uczogW2Z1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgdmFyIHBhcmVudCA9IHRoaXMuZ2V0UGFyZW50Q29tcG9uZW50R3JvdXAoKTtcbiAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuZ2V0TG9naWNhbFNwYWNlKHBhcmVudC5nZXRXaWR0aCgpLCBwYXJlbnQuZ2V0SGVpZ2h0KCkpO1xuICAgICAgICAgICAgfV1cbiAgICAgICAgICB9XVxuICAgICAgICB9XVxuICAgICAgfV1cbiAgICB9XSk7XG4gIH07XG5cbiAgc2V0RHJhd2luZ0NvbmZpZ3VyYXRpb24gKHgsIHksIHdpZHRoLCBoZWlnaHQsIGdyb3VwKSB7XG4gICAgdmFyIG1lcyA9IHRoaXMubWVhc3VyZW1lbnQ7XG4gICAgbWVzLnggPSB4O1xuICAgIG1lcy55ID0geTtcbiAgICBtZXMud2lkdGggPSB3aWR0aDtcbiAgICBtZXMuaGVpZ2h0ID0gaGVpZ2h0O1xuXG4gICAgdGhpcy5wYXJlbnRHcm91cCA9IGdyb3VwO1xuXG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgZHJhdyAoeCwgeSwgd2lkdGgsIGhlaWdodCwgZ3JvdXApIHtcbiAgICB2YXIgbWVhc3VyZW1lbnQgPSB0aGlzLm1lYXN1cmVtZW50LFxuICAgICAgdG9vbGJhcnMgPSB0aGlzLnRvb2xiYXJzLFxuICAgICAgbG4sXG4gICAgICBpLFxuICAgICAgdG9vbGJhcixcbiAgICAgIG1vZGVsID0gdGhpcy5nbG9iYWxSZWFjdGl2ZU1vZGVsLFxuICAgICAgc2VsZiA9IHRoaXM7XG4gICAgY29uc29sZS5sb2cobW9kZWwpO1xuICAgIHggPSB4ID09PSB1bmRlZmluZWQgPyBtZWFzdXJlbWVudC54IDogeDtcbiAgICB5ID0geSA9PT0gdW5kZWZpbmVkID8gbWVhc3VyZW1lbnQueSA6IHk7XG4gICAgd2lkdGggPSB3aWR0aCA9PT0gdW5kZWZpbmVkID8gbWVhc3VyZW1lbnQud2lkdGggOiB3aWR0aDtcbiAgICBoZWlnaHQgPSBoZWlnaHQgPT09IHVuZGVmaW5lZCA/IG1lYXN1cmVtZW50LmhlaWdodCA6IGhlaWdodDtcbiAgICBncm91cCA9IGdyb3VwID09PSB1bmRlZmluZWQgPyB0aGlzLnBhcmVudEdyb3VwIDogZ3JvdXA7XG4gICAgaWYgKHdpZHRoICYmIGhlaWdodCkge1xuICAgICAgZm9yIChpID0gMCwgbG4gPSB0b29sYmFycy5sZW5ndGg7IGkgPCBsbjsgaSsrKSB7XG4gICAgICAgIHRvb2xiYXIgPSB0b29sYmFyc1tpXTtcbiAgICAgICAgdG9vbGJhci5kcmF3KHgsIHkpO1xuICAgICAgfVxuICAgIH1cblxuICAgIG1vZGVsLm9uUHJvcHNDaGFuZ2UoWyd4LWF4aXMtdmlzaWJsZS1yYW5nZS1zdGFydCcsICd4LWF4aXMtdmlzaWJsZS1yYW5nZS1lbmQnXSwgZnVuY3Rpb24gKHN0YXJ0LCBlbmQpIHtcbiAgICAgIHNlbGYuZnJvbURhdGUuYmx1cihuZXcgRGF0ZShzdGFydFsxXSkudG9Mb2NhbGVEYXRlU3RyaW5nKCkpO1xuICAgICAgc2VsZi50b0RhdGUuYmx1cihuZXcgRGF0ZShlbmRbMV0pLnRvTG9jYWxlRGF0ZVN0cmluZygpKTtcbiAgICB9KTtcbiAgfTtcbn1cblxuaWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnICYmIHR5cGVvZiBtb2R1bGUuZXhwb3J0cyAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgbW9kdWxlLmV4cG9ydHMgPSBEYXRlUmFuZ2U7XG59IGVsc2Uge1xuICB3aW5kb3cuU3RhbmRhcmRQZXJpb2QgPSBEYXRlUmFuZ2U7XG59XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gLi9zcmMvZmN0cy1leHQtZGF0ZXJhbmdlLmpzIl0sInNvdXJjZVJvb3QiOiIifQ==